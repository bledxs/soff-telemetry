name: Update Telemetry

on:
  schedule:
    # Corre todos los dÃ­as a las 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch: # Permite ejecutar manualmente
  push:
    branches:
      - master
    paths:
      - 'src/**'
      - '.github/workflows/update-readme.yml'

jobs:
  update-badges:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¦ Install dependencies
        run: npm ci

      - name: ğŸ—ï¸ Build TypeScript
        run: npm run build

      - name: ï¿½ Update Contribution Badge
        run: npm run update-contribution
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ” Create pull request if changed
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          add-paths: |
            data/*.json
            data/*.svg
          commit-message: 'ğŸ¤– Update telemetry badges [skip ci]'
          title: 'ğŸ¤– Update telemetry badges'
          body: 'Automated update of telemetry data and SVG outputs.'
          branch: 'bot/update-telemetry'
          delete-branch: true
